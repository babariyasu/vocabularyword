<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" xmlns:sec="http://www.thymleaf.org/extras/spring-security">

<head>
	<div th:replace="~{fragment :: meta}"></div>
	<div th:replace="~{fragment :: styles}"></div>
	<title>ユーザーホーム画面</title>
</head>

<body>
	<div th:replace="~{fragment :: header}"></div>
	<main>
		<h1>単語帳一覧</h1>

		<ul>
			<li th:each="book : ${vocabularyBooks}">
				<a href="#" th:text="${book.title}"></a>
				<button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editModal"
					th:data-id="${book.id}" th:data-title="${book.title}">編集</button>
				<button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal"
					th:data-id="${book.id}" th:data-title="${book.title}">削除
				</button>
			</li>
		</ul>

	</main>
	<!-- 編集用モーダル -->
	<div class="modal fade" id="editModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">

				<div class="modal-header">
					<h5 class="modal-title">単語帳編集</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>

				<form id="editForm" method="post">
					<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
					<div class="modal-body">

						<input type="hidden" name="id" id="editBookId">

						<div class="mb-3">
							<label class="form-label">タイトル</label>
							<input type="text" class="form-control" name="title" id="editBookTitle" required>
						</div>

					</div>

					<div class="modal-footer">
						<button type="submit" class="btn btn-primary">
							更新する
						</button>

						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
							キャンセル
						</button>
					</div>
				</form>

			</div>
		</div>
	</div>
	<!-- 削除確認モーダル -->
	<div class="modal fade" id="deleteModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">

				<div class="modal-header">
					<h5 class="modal-title">削除確認</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>

				<div class="modal-body">
					<p>
						<span id="modalBookTitle"></span>
						を本当に削除しますか？
					</p>
				</div>

				<div class="modal-footer">

					<form id="deleteForm" method="post">

						<!-- CSRFトークン -->
						<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

						<button type="submit" class="btn btn-danger">
							削除する
						</button>
					</form>

					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
						キャンセル
					</button>

				</div>

			</div>
		</div>
	</div>

	<div th:replace="~{fragment :: footer}"></div>
	<div th:replace="~{fragment :: scripts}"></div>
	<script>
		const deleteModal = document.getElementById('deleteModal');

		deleteModal.addEventListener('show.bs.modal', function (event) {

			const button = event.relatedTarget;

			const bookId = button.getAttribute('data-id');
			const bookTitle = button.getAttribute('data-title');

			// タイトル表示
			document.getElementById('modalBookTitle').textContent = bookTitle;

			// actionを動的設定
			document.getElementById('deleteForm').action =
				'/vocabulary-books/' + bookId + '/delete';
		});
	</script>
	<script>
		const editModal = document.getElementById('editModal');

		editModal.addEventListener('show.bs.modal', function (event) {

			const button = event.relatedTarget;

			const bookId = button.getAttribute('data-id');
			const bookTitle = button.getAttribute('data-title');

			document.getElementById('editBookId').value = bookId;
			document.getElementById('editBookTitle').value = bookTitle;

			document.getElementById('editForm').action =
				'/vocabulary-books/' + bookId + '/update';
		});
	</script>
</body>

</html>